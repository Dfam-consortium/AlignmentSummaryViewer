/*! AlignmentSummaryViewer 11-12-2024 */
(t=>{function i(e,t,i,n){this.json=i,this.align_canvas=e,this.parent_element=t,this.cursorImage=null,this.cursorImageStartX=0,this.cursorImageStartY=0,this.cursorImageWidth=0,this.cursorImageHeight=0,this.fontSize=10,this.minLeftMargin=55,this.minTopMargin=10,this.minBottomMargin=10,this.coverageGraphHeight=125,this.legendHeight=30,this.alignmentGlyphHeight=2,this.alignmentSpacing=0,this.rulerHeight=20,this.yAxisFontSize=10,this.rulerVerticalMargin=10,this.gradientWindowFrac=.1,this.coverageGraphStartY=this.minTopMargin,this.rulerStartY=this.coverageGraphStartY+this.coverageGraphHeight,this.alignmentGraphStartY=this.rulerStartY+this.rulerHeight,this.legendStartY=this.alignmentGraphStartY+this.json.alignments.length*(this.alignmentGlyphHeight+this.alignmentSpacing);var a=this;this.align_canvas.addEventListener("mousemove",function(t){var i=e.getBoundingClientRect(),t={x:t.clientX-i.left,y:t.clientY-i.top};a.renderCrosshair(t.x,t.y)}),this.align_canvas.addEventListener("mouseout",function(t){null!==a.cursorImage&&a.align_context.putImageData(a.cursorImage,a.cursorImageStartX,a.cursorImageStartY)}),this.align_context=this.align_canvas.getContext("2d"),this.qualColor=["#ff6600","#ff9900","#ccff00","#66ff00","#00ff00","#99ff66","#00ffcc","#33ccff","#3399ff","#3333ff"],this.currRulerY=0,this.resize()}i.prototype.setData=function(t){this.json=t,this.align_context.clearRect(0,0,this.align_canvas.width,this.align_canvas.height),this.legendStartY=this.alignmentGraphStartY+this.json.alignments.length*(this.alignmentGlyphHeight+this.alignmentSpacing),this.cursorImage=null,this.resize()},i.prototype.renderCrosshair=function(t,i){var e,n=this.align_context,a=this.json.length/(this.align_canvas.width-this.minLeftMargin),a=Math.floor(a*(t-this.minLeftMargin))+1,r=this.align_context.measureText(""+this.json.length).width+6;null!==this.cursorImage&&(n.putImageData(this.cursorImage,this.cursorImageStartX,this.cursorImageStartY),this.cursorImage=null),i>=this.alignmentGraphStartY&&i<this.legendStartY&&t>this.minLeftMargin&&(this.cursorImageStartX=t-2*r,this.cursorImageStartY=this.rulerStartY,this.cursorImageWidth=r+2*r,this.cursorImageHeight=this.legendStartY-this.rulerStartY,this.cursorImage=n.getImageData(this.cursorImageStartX,this.cursorImageStartY,this.cursorImageWidth,this.cursorImageHeight),n.lineWidth=1,n.beginPath(),n.moveTo(t,this.rulerStartY),n.lineTo(t,this.legendStartY-1),n.stroke(),i-r<this.rulerStartY&&(i=this.rulerStartY+r+2),(t=t)+r/2>this.align_canvas.width&&(t=this.align_canvas.width-r/2),n.beginPath(),n.arc(t,i-r/2,r/2,0,2*Math.PI,!1),n.fillStyle="#ffffff",n.fill(),n.strokeStyle="#000000",n.stroke(),this.align_context.fillStyle="#000000",e=this.align_context.measureText(""+a).width,n.fillText(""+a,t-e/2,i-r/2+this.fontSize/2-1))},i.prototype.resize=function(){this.align_canvas.width=this.parent_element.offsetWidth,this.align_canvas.height=this.minTopMargin+this.coverageGraphHeight+this.rulerHeight+this.json.alignments.length*(this.alignmentGlyphHeight+this.alignmentSpacing)+this.legendHeight+this.minBottomMargin,this.render("norm")},i.prototype.ruler=function(t,i,e,n,a,r,s,h){this.align_context.beginPath(),this.align_context.moveTo(t,i),this.align_context.lineTo(t+e,i),this.align_context.stroke();if(this.align_context.font="normal 10px Arial",!(n<20)){var r=e/(r-a+1),o=h*r,l=s*r,g=n-10-2,c=g/2,m=(this.align_context.fillStyle="#000000",0);if(0<o)for(var f=0,m=o;m<e;m+=o){f+=1,this.align_context.beginPath(),this.align_context.moveTo(t+m,i),this.align_context.lineTo(t+m,i+g),this.align_context.stroke();var u=this.align_context.measureText(""+f*h).width;this.align_context.fillText(""+f*h,t+m-u/2,i+g+10)}if(0<l)for(m=l;m<e;m+=l)this.align_context.beginPath(),this.align_context.moveTo(t+m,i),this.align_context.lineTo(t+m,i+c),this.align_context.stroke()}},i.prototype.coverageGraph=function(t,i){var e=this.json.alignments,n=new Array(this.json.length).fill(0),a=this.json.length/(this.align_canvas.width-this.minLeftMargin),r=(this.align_canvas.width-this.minLeftMargin)/this.json.length,s=this.align_context,h=t+this.yAxisFontSize/2,o=i-(h-t);if(s.beginPath(),s.moveTo(this.minLeftMargin-1,h),s.lineTo(this.minLeftMargin-1,t+i),s.stroke(),s.save(),s.translate(10,i/2),s.rotate(-Math.PI/2),s.textAlign="center",s.font="normal 10px Arial",s.fillText("Number of Matches",1,0),s.restore(),!(i<=h)){var l=0,g=0,c=0;for(g=0;g<e.length;g+=1)for(var m=e[g][1]-1,f=e[g][2],c=m;c<=m+f;c+=1)void 0!==n[c]?n[c]=n[c]+1:n[c]=1,n[c]>l&&(l=n[c]);for(var u=this.align_context.measureText(""+(l=l<10?10:l)).width,x=(s.fillText(""+l,this.minLeftMargin-u-8,t+this.yAxisFontSize),s.beginPath(),s.moveTo(this.minLeftMargin,h),s.lineTo(this.minLeftMargin-5,h),s.stroke(),0),p=this.nice_bounds(0,l,5),x=p.steps;x<p.max;x+=p.steps){var d=t+i-this.scale(x,l,o);if(d<=10)break;var _=this.minLeftMargin,v=(s.beginPath(),s.moveTo(_,d),s.lineTo(_-5,d),s.stroke(),""+x),u=s.measureText(v).width;s.fillText(v,_-u-8,d)}var S=o/l,M=(this.align_context.fillStyle="#739025",this.align_context.strokeStyle="#000000",this.minLeftMargin);if(1<=a)for(var T=this.align_canvas.width-this.minLeftMargin,y=(this.align_context.beginPath(),this.align_context.moveTo(M,t+i-1),0),g=0;g<T;g+=1){var Y=0;for(c=0;c<Math.floor(a);c+=1)Y+=n[Math.floor(y)+c];Y+=n[Math.floor(y)+c+1]*(a%1),y+=a,this.align_context.lineTo(M,t+i-Y/a*S-1),M+=1}else{for(this.align_context.beginPath(),this.align_context.moveTo(M,t+i-1),g=0;g<this.json.length;g+=1){var L=n[g];this.align_context.lineTo(M,t+i-L*S-1),M+=r}this.align_context.lineTo(M,t+i-L*S-1)}this.align_context.lineTo(M,t+i-1),this.align_context.lineTo(0,t+i-1),this.align_context.fill(),this.align_context.closePath()}},i.prototype.nice_bounds=function(t,i,e){e=e||10;var n=i,a=i-t,a=(0===a&&(a=(i+=.5)-(t-=.5)),this.nice_number(a)),a=this.nice_number(a/(e-1),!0);return{min:t=Math.floor(t/a)*a,max:i=n-(i=Math.ceil(i/a)*a)<a/4?Math.floor(n/a)*a:i,steps:a}},i.prototype.nice_number=function(t,i){i=i||!1;var e=Math.floor(Math.log(t)/Math.log(10)),t=t/Math.pow(10,e),i=i?t<1.5?1:t<3?2:t<7?5:10:t<=1?1:t<=2?2:t<=5?5:10;return i*Math.pow(10,e)},i.prototype.scale=function(t,i,e){return e*t/i},i.prototype.render=function(t){for(var i=this.alignmentGlyphHeight,e=this.alignmentSpacing,n=this.rulerHeight,a=this.rulerVerticalMargin,r=this.coverageGraphHeight,s=this.gradientWindowFrac,h=this.align_canvas.width-this.minLeftMargin,o=h/this.json.length,l=this.json.alignments,g=this.json.qualityBlockLen,c=g*o,m=l.length*(this.alignmentGlyphHeight+this.alignmentSpacing),f=(this.cursorImage=null,this.align_context.clearRect(0,0,this.align_canvas.width,this.align_canvas.height),this.align_context),u=(f.beginPath(),f.moveTo(this.minLeftMargin-1,this.rulerStartY),f.lineTo(this.minLeftMargin-1,this.rulerStartY+this.rulerHeight+m),f.stroke(),f.save(),f.translate(10,this.alignmentGraphStartY+m/2),f.rotate(-Math.PI/2),f.textAlign="center",f.font="normal 10px Arial",f.fillText("Sequence",1,0),f.restore(),this.align_context.measureText("1").width),m=(f.fillText("1",this.minLeftMargin-u-8,this.alignmentGraphStartY),f.beginPath(),f.moveTo(this.minLeftMargin,this.alignmentGraphStartY+1),f.lineTo(this.minLeftMargin-5,this.alignmentGraphStartY+1),f.stroke(),u=this.align_context.measureText(""+l.length).width,f.fillText(""+l.length,this.minLeftMargin-u-8,this.alignmentGraphStartY+m+this.yAxisFontSize),f.beginPath(),f.moveTo(this.minLeftMargin,this.alignmentGraphStartY+m),f.lineTo(this.minLeftMargin-5,this.alignmentGraphStartY+m),f.stroke(),this.legendStartY+15),x=this.minLeftMargin+20,p=this.align_context.createLinearGradient(x,0,x+100,0),d=1/this.qualColor.length,_=0,_=0;_<this.qualColor.length;_+=1)p.addColorStop(d*_,this.qualColor[_]);f.fillStyle=p,f.fillRect(x,m,100,5),f.fillStyle="#000000",f.fillText("Alignment quality over "+g+"bp non-overlapping windows",x+100+10,m+this.yAxisFontSize),f.fillText("low",x,m+5+this.yAxisFontSize),u=this.align_context.measureText("high").width,f.fillText("high",x+100-u,m+5+this.yAxisFontSize),"orient"==t?l.sort(function(t,i){return t[4]===i[4]?"R"===t[4]?t[1]===i[1]?i[2]-t[2]:t[1]-i[1]:t[1]===i[1]?t[2]-i[2]:i[1]-t[1]:t[4]<i[4]?-1:t[4]>i[4]?1:0}):"end"==t?l.sort(function(t,i){return t[1]+t[2]==i[1]+i[2]?t[1]-i[1]:i[1]+i[2]-(t[1]+t[2])}):"div"==t?l.sort(function(t,i){return t[5]-i[5]}):l.sort(function(t,i){return t[1]===i[1]?i[2]-t[2]:t[1]-i[1]}),this.coverageGraph(this.coverageGraphStartY,this.coverageGraphHeight);var v=0,S=0;for("orient"!=t&&(f=this.nice_bounds(1,this.json.length,10).steps,this.ruler(this.minLeftMargin,this.rulerStartY,h,n,1,this.json.length,f/10,f),this.currRulerY=0,v=a+n+r,S=1),_=0;_<l.length;_+=1){0===S&&"R"==l[_][4]&&(v+=a,this.currRulerY=v+_*(e+i),v=v+n+a+r,S=1);for(var M=l[_][1]-1,T=l[_][3],y=0,Y=0;Y<l[_][2];Y+=g){y==T.length&&(y-=1);var L=T[y],I=y==T.length-1?L:T[y+1],w=this.minLeftMargin+(M+Y)*o,G=this.align_context.createLinearGradient(w,0,w+c,0),L=(G.addColorStop(0,this.qualColor[L-1]),G.addColorStop(1-s,this.qualColor[L-1]),G.addColorStop(1,this.qualColor[I-1]),this.align_context.fillStyle=G,(g+.5)*o);Y+g>=l[_][2]&&(L=(l[_][2]-Y)*o),this.align_context.fillRect(w,v+_*(e+i),L,i),this.minLeftMargin,y++}}},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=i:(t.AlignmentSummaryViewer=i,"function"==typeof define&&define.amd&&define("alignmentsummaryviewer",[],function(){return i}))})(this.window||"undefined"!=typeof global&&global||this);